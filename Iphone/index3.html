
<!--
> Muaz Khan     - https://github.com/muaz-khan
> MIT License   - https://www.webrtc-experiment.com/licence/
> Documentation - https://github.com/streamproc/MediaStreamRecorder
> =================================================================
> gif-recorder.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <title>HTML5 WebPage Activity Recording using RecordRTC</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="author" type="text/html" href="https://plus.google.com/+MuazKhan">
<meta name="author" content="Muaz Khan">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

<style>

}
</style>
<body>
	<section class="design-surface">
<iframe src="//giphy.com/embed/BPxJjwsNBDMdy" width="480" height="348.38709677419354" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/rihanna-gif-BPxJjwsNBDMdy">via GIPHY</a></p>
		<canvas id="temp-canvas"></canvas>
		<canvas id="main-canvas" opacity=0></canvas>
	</section>

    <script src="https://cdn.webrtc-experiment.com/RecordRTC/Canvas-Recording/canvas-designer.js"></script>
	<script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
	<script src="https://cdn.webrtc-experiment.com/getScreenId.js"></script>





    <input type="text" id="text-input" style="position: absolute; top: -100000px; left: -100000px; z-index: 1000000;border:0;outline:none; font-size: 15px;padding:0;margin:0; background: transparent; width: 100%;">

	<!------------------------------------------>

  	<div class="start-top-recording" style="position: absolute;top: 3px;right: 20px;z-index: 9;">


	    <button id="start">Start Canvas Recording</button>
	    <button id="stop" disabled>Stop</button>
	</div>



<script src="https://cdn.webrtc-experiment.com/screenshot.js"></script>
<script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
<script src="https://cdn.WebRTC-Experiment.com/gumadapter.js"></script>

<script>
var params = {
    		tools: JSON.stringify({
    			pencil: true,
    			// dragMultiple: true,
    			eraser: true,
    			text: true
    			/*image: true,
		        line: true,
		        dragSingle: true,
		        rectangle: true,
		        arc: true,
		        bezier: true,
		        quadratic: true,
		        */
    		}),
	        selectedIcon: 'pencil'
    	}



  var recorder;
	document.getElementById('start').onclick = function() {
	    document.getElementById('start').disabled = true;
	    recorder = new RecordRTC(window.canvasElementToBeRecorded, {
			type: 'canvas',
		    disableLogs: false
		});
	    recorder.startRecording();
	    setTimeout(function() {
	         document.getElementById('stop').disabled = false;
	    }, 1000);
	};
	document.getElementById('stop').onclick = function() {
	   this.disabled = true;
	   document.body.innerHTML = '<h1 style="font-size:30px;text-align:center;margin:15px;color:red;font-weight:normal;">Please check page title for the encoding progress.<br><br>Frames are being encoded to generate a HD smooth WebM!<br><br><small>Please never click "kill" button; otherwise the entire encoding process will be crashed.</small></h1>';
	   setTimeout(function() {
		   	recorder.stopRecording(function() {
		   		var blob = recorder.getBlob();
		    	var video = document.createElement('video');
		        video.src = URL.createObjectURL(blob);
		        video.setAttribute('style', 'height: 100%; position: absolute; top:0; left:0;z-index:9999;width:100%;');
		        document.body.appendChild(video);
		        video.controls = true;
		        video.play();
		    });
		}, 100);
	};
	document.getElementById('capture-screen').onclick = function() {
		this.disabled = true;
		getScreenId(function (error, sourceId, screen_constraints) {
			if(error) {
				alert(error);
				return;
			}
			if(sourceId === 'firefox') {
				screen_constraints.video.width = screen.width;
				screen_constraints.video.height = screen.height;
			}
			else {
				screen_constraints.video.mandatory.maxWidth =
				screen_constraints.video.mandatory.minWidth = screen.width;
				screen_constraints.video.mandatory.maxHeight =
				screen_constraints.video.mandatory.minHeight = screen.height;
				screen_constraints.video.mandatory.minAspectRatio = 1.77;
			}
		    navigator.getUserMedia = navigator.mozGetUserMedia || navigator.webkitGetUserMedia;
		    navigator.getUserMedia(screen_constraints, function (stream) {
		    	window.screenVideoElement = document.createElement('video');
		    	screenVideoElement.onloadedmetadata = function() {
			    	window.canvasElementToBeRecorded.getContext('2d').drawImage(
			    		screenVideoElement, 0, -50,
			    		window.canvasElementToBeRecorded.width,
			    		window.canvasElementToBeRecorded.height);
			    	document.getElementById('capture-screen').disabled = false;
			    	stream.stop();
			    };
			    screenVideoElement.src = URL.createObjectURL(stream);
		    	screenVideoElement.play();
		    }, function (error) {
		        alert(JSON.stringify(error));
		    });
		});
	};
	window.onbeforeunload = function() {
	    document.getElementById('start').disabled = false;
	    document.getElementById('stop').disabled = true;
	};

</script>
</body>

</html>
